{% extends "dashboard/admin/base.html" %}
{% load static %}

{% block page_title %}System Settings{% endblock %}

{% block admin_content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-100">System Settings</h1>
        <button onclick="addSetting()" class="btn btn-primary">
            <i class="fas fa-plus mr-2"></i> Add Setting
        </button>
    </div>

    <!-- Settings List -->
    <div class="card">
        <div class="card-body p-0">
            {% if settings %}
            <div class="overflow-x-auto">
                <table class="responsive-table">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                            <th>Description</th>
                            <th>Public</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for setting in settings %}
                        <tr>
                            <td>
                                <span class="text-gray-100 font-mono text-sm">{{ setting.key }}</span>
                            </td>
                            <td>
                                <span class="text-gray-100">{{ setting.value|truncatechars:50 }}</span>
                            </td>
                            <td>
                                <span class="text-gray-400 text-sm">{{ setting.description|default:"No description" }}</span>
                            </td>
                            <td>
                                <span class="px-2 py-1 text-xs font-medium rounded-full {% if setting.is_public %}bg-green-900 text-green-200{% else %}bg-gray-700 text-gray-300{% endif %}">
                                    {% if setting.is_public %}Public{% else %}Private{% endif %}
                                </span>
                            </td>
                            <td>
                                <span class="text-gray-400 text-sm">{{ setting.updated_at|date:"M d, Y H:i" }}</span>
                            </td>
                            <td>
                                <div class="flex space-x-2">
                                    <button onclick="editSetting('{{ setting.key }}', '{{ setting.value }}', '{{ setting.description }}', {{ setting.is_public|yesno:'true,false' }})" class="text-blue-400 hover:text-blue-300 text-sm">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteSetting('{{ setting.key }}')" class="text-red-400 hover:text-red-300 text-sm">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-12">
                <i class="fas fa-cog text-6xl text-gray-500 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-300 mb-2">No system settings found</h3>
                <p class="text-gray-500 mb-6">Get started by adding your first system setting.</p>
                <button onclick="addSetting()" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Add First Setting
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Setting Modal -->
<div id="settingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 id="modalTitle" class="text-lg font-semibold text-gray-100">Add Setting</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="settingForm" class="space-y-4">
            <div>
                <label class="form-label">Key</label>
                <input type="text" id="settingKey" class="form-input" required>
            </div>
            <div>
                <label class="form-label">Value</label>
                <textarea id="settingValue" class="form-textarea" rows="3" required></textarea>
            </div>
            <div>
                <label class="form-label">Description</label>
                <textarea id="settingDescription" class="form-textarea" rows="2"></textarea>
            </div>
            <div>
                <label class="flex items-center">
                    <input type="checkbox" id="settingPublic" class="mr-2">
                    <span class="text-gray-100">Public</span>
                </label>
            </div>
            <div class="flex justify-end space-x-4">
                <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<style>
.space-y-4 > * + * {
    margin-top: 1rem;
}

.space-x-2 > * + * {
    margin-left: 0.5rem;
}

.space-x-4 > * + * {
    margin-left: 1rem;
}

.font-mono {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.text-blue-400 {
    color: #60a5fa;
}

.text-blue-300 {
    color: #93c5fd;
}

.text-red-400 {
    color: #f87171;
}

.text-red-300 {
    color: #fca5a5;
}

.text-gray-100 {
    color: #f3f4f6;
}

.text-gray-400 {
    color: #9ca3af;
}

.text-gray-500 {
    color: #6b7280;
}

.text-gray-300 {
    color: #d1d5db;
}

.text-xl {
    font-size: 1.25rem;
}

.text-6xl {
    font-size: 3.75rem;
}

.font-semibold {
    font-weight: 600;
}

.text-sm {
    font-size: 0.875rem;
}

.text-xs {
    font-size: 0.75rem;
}

.font-medium {
    font-weight: 500;
}

.mb-2 {
    margin-bottom: 0.5rem;
}

.mb-4 {
    margin-bottom: 1rem;
}

.mb-6 {
    margin-bottom: 1.5rem;
}

.mb-12 {
    margin-bottom: 3rem;
}

.mr-2 {
    margin-right: 0.5rem;
}

.py-12 {
    padding-top: 3rem;
    padding-bottom: 3rem;
}

.max-w-md {
    max-width: 28rem;
}

.w-full {
    width: 100%;
}

.mx-4 {
    margin-left: 1rem;
    margin-right: 1rem;
}

.p-6 {
    padding: 1.5rem;
}

.bg-gray-800 {
    background-color: #1f2937;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.justify-end {
    justify-content: flex-end;
}

.items-center {
    align-items: center;
}

.flex {
    display: flex;
}

.hover\:text-blue-300:hover {
    color: #93c5fd;
}

.hover\:text-red-300:hover {
    color: #fca5a5;
}

.hover\:text-gray-200:hover {
    color: #e5e7eb;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-black {
    background-color: #000000;
}

.bg-opacity-50 {
    opacity: 0.5;
}

.hidden {
    display: none;
}

.z-50 {
    z-index: 50;
}

@media (max-width: 768px) {
    .flex {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>

<script>
let currentKey = null;

function addSetting() {
    currentKey = null;
    document.getElementById('modalTitle').textContent = 'Add Setting';
    document.getElementById('settingKey').value = '';
    document.getElementById('settingValue').value = '';
    document.getElementById('settingDescription').value = '';
    document.getElementById('settingPublic').checked = false;
    document.getElementById('settingKey').disabled = false;
    
    showModal();
}

function editSetting(key, value, description, isPublic) {
    currentKey = key;
    document.getElementById('modalTitle').textContent = 'Edit Setting';
    document.getElementById('settingKey').value = key;
    document.getElementById('settingValue').value = value;
    document.getElementById('settingDescription').value = description;
    document.getElementById('settingPublic').checked = isPublic;
    document.getElementById('settingKey').disabled = true;
    
    showModal();
}

function deleteSetting(key) {
    if (confirm('Are you sure you want to delete this setting?')) {
        // Delete functionality would go here
        alert('Delete functionality would be implemented here');
    }
}

function showModal() {
    const modal = document.getElementById('settingModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeModal() {
    const modal = document.getElementById('settingModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

document.getElementById('settingForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const key = document.getElementById('settingKey').value;
    const value = document.getElementById('settingValue').value;
    const description = document.getElementById('settingDescription').value;
    const isPublic = document.getElementById('settingPublic').checked;
    
    // Save functionality would go here
    alert('Save functionality would be implemented here');
    closeModal();
});
</script>
{% endblock %}
